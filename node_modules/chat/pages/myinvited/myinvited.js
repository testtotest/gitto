const app = getApp();
Page({
  /**
   * 页面的初始数据
   */
  data: {
    img:app.globalData.staticImg,
    invCode:app.globalData.invCode,
    title: "已申请办理",
    active: true,
    ishow:1, //1  已申请办理内容显示  2   邀请列表展示
    inviteList:[],
    invitedList:[]
  },
  copyInvCode:function(){
    let that =this
    wx.setClipboardData({
      data: that.data.invCode,
      success (res) {
        wx.showToast({
          title: '邀请码已复制',
          icon: 'success',
          duration: 2000
        })
        // wx.getClipboardData({
        //   success (res) {
        //     console.log(res.data) // data
        //   }
        // })
      }
    })
  },
  gobefore:function(){
    wx.navigateTo({
      url: '../myinvite/myinvite',
    })
  },
  handleReward: function () {
    this.setData({
      ishow: 1,
      active: true,
    });
    this.getInviteList()
  },
  handleCash: function () { //点击邀请列表
    this.setData({
      ishow: 2,
      active: false,
     // invite:[]
    });
    this.getInvitedList()
  },
  //获取邀请列表
  getInvitedList:function(){
    let that =this
    wx.request({
      url: app.globalData.baseUrl + "/ty/heatingApplet/invite/friendsHaveInvited",
      method: "POST",
      data: {
        userId:app.globalData.userId,
        // pageNo:pageNo,
        // pageSize:pageSize,
      },
      header: {
        "content-type": "application/json", // 默认值
        token: app.globalData.token,
      },
      success: (res) => {
      //  console.log("邀请列表————————", res.data.result.list);
        that.setData({
          invitedList:res.data.result.list
        })
      },
    });
  },
  //已申请办理列表展示
  getInviteList:function(pageNo,pageSize){
    let that =this
    wx.request({
      url: app.globalData.baseUrl + "/ty/heatingApplet/invite/myInviteList",
      method: "POST",
      data: {
        userId:app.globalData.userId,
        pageNo:pageNo,
        pageSize:pageSize,
      },
      header: {
        "content-type": "application/json", // 默认值
        token: app.globalData.token,
      },
      success: (res) => {

      //  console.log("邀请数据_", res.data.result.list);
        that.setData({
          inviteList:res.data.result.list
        })
        wx.hideLoading({
          icon:"none"
        })
        wx.stopPullDownRefresh()
      },
    });
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    wx.showLoading({
      title: '页面加载中...',
    })
    this.setData({
      img:app.globalData.staticImg,
      invCode:app.globalData.invCode
    })
    this.getInviteList(1,100)

  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {},

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {},

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {},

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {},

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh:function(){
    wx.showLoading({
      title: '页面重新加载中...',
    })
    this.getInviteList(1,100)
  },


  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {},

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function (res) {
    if (res.from === 'button') {
      // 来自页面内转发按钮
    //  console.log(res.target)
    }
    return {
      title: app.globalData.shareTitle,
      imageUrl:app.globalData.shareImgUrl,
      path: '/pages/index/index?invCode='+app.globalData.invCode
    }
  },
});
