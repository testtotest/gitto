// pages/caselist/caselist.js
var app = getApp()
Page({

    /**
     * 页面的初始数据
     */
    data: {
        pageNo: 1,
        pageSize: 10,
        caseData:[],
        totalCount: 0,
        nodata: false,
        scrollHeight: 0,
        show: false,
        triggered: false,
    },

    onScrollLower:function(){
        var totalPage = Math.ceil(this.data.totalCount / this.data.pageSize)
        console.log(totalPage)
        console.log(this.data.pageNo)
         if(totalPage < this.data.pageNo){
            this.setData({
                nodata: true
            })
            return
        }
        this.setData({
            show: true
        })
        setTimeout(()=>{this.getCasesDate()},300)
    },

    refresh(){
        console.log(11)
        if (this._freshing) return
        this._freshing = true
        setTimeout(()=>{
            console.log('下拉刷新');
            this.setData({
                pageNo: 1,
                triggered: true
            })
            this.getCasesDate();
            this._freshing = false
          },300);
    },

    getCasesDate() {
        var that = this;
        wx.request({
            url: app.globalData.baseUrl + `/ty/heatingApplet/cases/query?pageNo=${that.data.pageNo}&pageSize=${that.data.pageSize}`,
            method: "get",
            header: {
                "content-type": "application/json", // 默认值
                "token": app.globalData.token
            },
            data: {},
            success: (res) => {
                if(that.data.pageNo == 1){ // 下拉刷新
                    that.setData({
                      caseData: res.data.result.list,
                      triggered: false
                    })
                }else{ //加载更多
                    var list = that.data.caseData;
                    for(var v of res.data.result.list){
                        list.push(v)
                    }
                    that.setData({
                        caseData: list,
                        totalCount: res.data.result.count,
                        pageNo: that.data.pageNo+1,
                        show: false
                    });
                }
               
            },
        });
    },

    /**
     * 生命周期函数--监听页面加载
     */
    onLoad: function (options) {
        var that = this;
        wx.getSystemInfo({
            success: function (res) {
                console.info(res.windowHeight);
                that.setData({
                    scrollHeight: res.windowHeight
                });
            }
        });

        
    },

    /**
     * 生命周期函数--监听页面初次渲染完成
     */
    onReady: function () {

    },

    /**
     * 生命周期函数--监听页面显示
     */
    onShow: function () {
        this.getCasesDate()
    },

    /**
     * 生命周期函数--监听页面隐藏
     */
    onHide: function () {

    },





})