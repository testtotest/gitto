// pages/product/product.js
const util =require("../../utils/util.js");
const app = getApp()
Page({

  /**
   * 页面的初始数据
   */
  data: {
    id:'',
    token:'',
    title:'设备产品',
    productData: [
      // {
      //   id:1,
      //   photo1:'/images/chanpin1@2x.png',
      //   name:'挂壁式电暖炉',
      //   characteristicArr:['产品特点1','产品特点2','产品特点3']
      // },
    ],
    descImg:'',
    photo3Height:''
  },
  getProductData: function (id,tag) {
    var that = this
    that.setData({
      id:id
    })
    var url
    if(tag=='hot'){
      url =  app.globalData.baseUrl + '/ty/heatingApplet/equipment/hotEquipment'
    }else if(tag == 'common'){
      url =  app.globalData.baseUrl + '/ty/heatingApplet/equipment/equipmentList'
    }
    wx.request({
      url: url,
      method: 'POST',
      header: {
        'content-type': 'application/json', // 默认值
        token: app.globalData.token
      },
      data: {
        id:id
      },
      success: (res) => {
		 
      //  console.log('getProductData2', res, res.data.result)
      var data = res.data.result;
      var productData = data.filter((item) => {
          return item.id == id
      })
        wx.getImageInfo({
          src: productData[0].photo3,
          success (res) {
          //  console.log('图片的宽:',res.width)
          //  console.log('图片的高是:',res.height)
            that.setData({
              photo3Height:res.height
            })
            wx.hideLoading()
          }
        })
        that.setData({
          productData: productData,
          descImg: productData[0].photo3
        })

      }
    })
  },
  goApply:function(){
    wx.navigateTo({
      url: '../productdetail/productdetail?id='+this.data.id,
    })
  },
  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    wx.showLoading({
      title: '页面加载中',
    })
  //  console.log('产品详情options.id_________', options)
    this.getProductData(options.id,options.tag)
  },
  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {

  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function (res) {
    if (res.from === 'button') {
      // 来自页面内转发按钮
    //  console.log(res.target)
    }
    return {
      title: app.globalData.shareTitle,
      imageUrl:app.globalData.shareImgUrl,
      path: '/pages/index/index?invCode='+app.globalData.invCode
    }
  },

  onShareTimeline: function(){
    return {
      title: app.globalData.shareTitle,
      imageUrl:app.globalData.shareImgUrl,
      path: '/pages/index/index?invCode='+app.globalData.invCode
    }
  },
})
