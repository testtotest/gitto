var app = getApp()
Page({

  /**
   * 页面的初始数据
   */
  data: {
    isbg:false,
    showe: false, //企业主体证明类型
    isshowe:'请选择',	
    items: [{
            message: '营业执照',
          },{
            message: '组织机构代码证'
          },{
            message: '宗教活动场所登记证'
          },{
            message: '社会团体法人登记证书'
          },{
            message: '军队、武警出具的办理用电业务的证明'
          }],
	showa: false, //企业主体证明类型
	isshowa:'请选择',	
	itemsa: [{
	        message: '产权证',
	      },{
	        message: '国有土地使用证'
	      },{
	        message: '集体土地使用证'
	      },{
	        message: '购房合同'
	      },{
	        message: '法律文书'
	      },{
	        message: '产权合法证明'
	      },{
	        message: '其他(产权证、租赁协议)'
	      }],
		imgc:'', //企业主体照片
		imgz:[], //证明照片集合
		imgzz:[], //证明照片集合
		 token:'MTkwLTE2MDEzNDY5ODA0MTgtMWY3ODA4ZjUwYmQ5NGVhZWEzYTIzNGE2MjQ0MDMwY2I=',
  },
btnForm:function (){
	
	var _this = this
	
	if (_this.data.isshowe=="请选择") {
		wx.showToast({
			title: "请选择企业主体证明类型",
			icon: "none",
			duration: 2000,
		});
		return false;
	}
	if (_this.data.imgz.length<=0) {
		wx.showToast({
			title: "产权证明照片不得为空",
			icon: "none",
			duration: 2000,
		});
		return false;
	}
	if (!_this.data.enterpriseName) {
		wx.showToast({
			title: "企业名称不得为空",
			icon: "none",
			duration: 2000,
		});
		return false;
	}
	if (!_this.data.imgc) {
		wx.showToast({
			title: "企业主体照片不得为空",
			icon: "none",
			duration: 2000,
		});
		return false;
	}
	
	wx.setStorageSync("typeProof",_this.data.isshowe) //企业主体证明类型
	wx.setStorageSync("enterpriseName",_this.data.enterpriseName)	
	wx.setStorageSync("companyPhoto",_this.data.imgc) //企业主体照片
	wx.setStorageSync("equityProveType",_this.data.isshowa)
	wx.setStorageSync("equityProveList",_this.data.imgz) //产权证明照片	
	wx.navigateTo({url:"./comc"})
	// var typeProofInt
	//  if(_this.data.isshowe=="营业执照")
	//        typeProofInt=1
	//  else if(_this.data.isshowe=="组织机构代码证")
	//        typeProofInt=2
	// else if(_this.data.isshowe=="宗教活动场所登记证")
	//       typeProofInt=3
	// else if(_this.data.isshowe=="社会团体法人登记证书")
	//       typeProofInt=4
	// else if(_this.data.isshowe=="军队、武警出具的办理用电业务的证明")
	//       typeProofInt=5
 //    console.log(typeProofInt)
}, 
choosecImg: function (e) {
  		this.up("c");	
},
choosezImg: function (e) {
	var imgz = this.data.imgz;
	if (imgz.length >= 6) {
		wx.showToast({
		    title: "最多可上传6张照片",
		    icon: "none",
		    duration: 2000,
		});
		return false;		
	}
  		this.up("z");	
},
up:function(t)
{
	var that = this;	
	wx.chooseImage({
	  // count: 1, // 默认9
	  sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
	  sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
	  success: function (res) {
		// 返回选定照片的本地文件路径列表，tempFilePath可以作为img标签的src属性显示图片
			var tempFilePaths = res.tempFilePaths;
			var imgs = that.data.imgs;
				var imgc = that.data.imgc;
				var imgz = that.data.imgz;
				var imgzz = that.data.imgzz;
		// console.log(tempFilePaths + '----');
			    if(t=="c")
				{
					that.setData({
					  imgcc: tempFilePaths[0]
					});
					that.toBase(tempFilePaths[0],"c")				
				}
				else if(t=="z"){
					var imgstr={"photo":tempFilePaths[0]}
					imgzz.push(imgstr);
					that.setData({
					   imgzz: imgzz
					});
					that.toBase(tempFilePaths[0],"z")					
				}
	  }
	});
}, 
toBase: function (e,t) {
	var that = this;
	var imgc = that.data.imgc; //企业主体照片
	var imgz = that.data.imgz; //证明照片集合
	wx.uploadFile({
			 url: app.globalData.baseUrl+"/ty/heatingApplet/file/upload",
			 filePath: e,//图片在手机里的存储路径
			 name: 'file', 
			 header: {				
					 "token": app.globalData.token
			 },			  
			 success(res) {
				const data = JSON.parse(res.data);
				if(data.status == 0){
					if(t=="c")
					{
						that.setData({
						  imgc: data.result
						});	
					} else if(t=="z"){
						var imgstr={"photo":data.result}
						imgz.push(imgstr);
						that.setData({
						   imgz: imgz
						});
					} 
				}				
			 }
	})
	
}, 
//企业主体证明类型选择
onBtnb:function (){	
	this.setData({showe:true,isbg:true})
},
selBtnb:function (res){
	this.setData({isshowe:this.data.items[res.currentTarget.id].message})
	this.setData({showe:false,isbg:false})
},
cloBtnb:function (){
	this.setData({showe:false,isbg:false})
},
//产权证明类型选择
onBtna:function (){	
	this.setData({showa:true,isbg:true})
},
selBtna:function (res){
	this.setData({isshowa:this.data.itemsa[res.currentTarget.id].message})
	this.setData({showa:false,isbg:false})		
},
cloBtna:function (){
	this.setData({showa:false,isbg:false})
},
  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
       
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {

  },

 
})