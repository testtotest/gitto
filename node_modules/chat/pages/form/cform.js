// pages/form/cform.js
Page({
 
  /**
   * 页面的初始数据
   */
  data: {
    imgs: [],
    placeholder: '请选择',
    array: ['发电机', '充电器', '引擎动力', '其他'],
    objectArray: [
      {
        id: 0,
        name: '发电机'
      },
      {
        id: 1,
        name: '充电器'
      },
      {
        id: 2,
        name: '引擎动力'
      },
      {
        id: 3,
        name: '其他'
      }
    ],
 
    multiIndex: [0, 0, 0],
    date: '2016-09-01',
    time: '12:01',
    region: ['广东省', '广州市', '海珠区'],
    customItem: '全部',
	nodata: true,
	addresslist: [],
	showAddressModel: false,
	province: [],
	city: [],
	county: [],
	addressView: [],
  },
  //console.log(wx.getStorageSync("t1"))
  // 上传图片
  chooseImg: function (e) {
    var that = this;
    var imgs = this.data.imgs;
    if (imgs.length >= 9) {
      this.setData({
        lenMore: 1
      });
      setTimeout(function () {
        that.setData({
          lenMore: 0
        });
      }, 2500);
      return false;
    }
    wx.chooseImage({
      // count: 1, // 默认9
      sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
      sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
      success: function (res) {
        // 返回选定照片的本地文件路径列表，tempFilePath可以作为img标签的src属性显示图片
        var tempFilePaths = res.tempFilePaths;
        var imgs = that.data.imgs;
        // console.log(tempFilePaths + '----');
        for (var i = 0; i < tempFilePaths.length; i++) {
          if (imgs.length >= 9) {
            that.setData({
              imgs: imgs
            });
            return false;
          } else {
            imgs.push(tempFilePaths[i]);
          }
        }
         //console.log(imgs);
        that.setData({
          imgs: imgs
        });
      }
    });
  },
  // 删除图片
  deleteImg: function (e) {
    var imgs = this.data.imgs;
    var index = e.currentTarget.dataset.index;
    imgs.splice(index, 1);
    this.setData({
      imgs: imgs
    });
  },
  // 预览图片
  previewImg: function (e) {
    //获取当前图片的下标
    var index = e.currentTarget.dataset.index;
    //所有图片
    var imgs = this.data.imgs;
    wx.previewImage({
      //当前显示图片
      current: imgs[index],
      //所有图片
      urls: imgs
    })
  },
 
 
 
  bindPickerChange(e) {
    console.log('picker发送选择改变，携带值为', e.detail.value)
    this.setData({
      index: e.detail.value
    })
  },
  clearFont() {
    this.setData({
      placeholder: ''
    })
  },
 
  bindRegionChange(e) {
    console.log('picker发送选择改变，携带值为', e.detail.value)
    this.setData({
      region: e.detail.value
    })
  },
 changeDate:function(e){
     //获取当前选择日期
     var date = e.detail.value;
     this.setData({
       currentDate:date
     })
   },
    addForm:function(e){
		//1000068
		//console.log(this.data.imgs)
		var that = this;
		wx.request({
		    url:  "https://testxny.tongyunzn.com/ty/heatingApplet/newclothes/addNewClothes",
		    method: "post",
		    header: {
		        "content-type": "application/json", // 默认值
		        "token": 'MTkwLTE2MDEwOTYzMjkyNzktMGNiMDZmMWQ4OGRjNGM3YTg1ZDlhYjBmOTY4NGM0NzA='
		    },
		    data: {
		        type: '2',
		        region: "1000068",
		        address: "地址测试",
				powerConsumptionTime: that.data.currentDate,
				equityProveType: "证明类型测试",
				documentType: "法人证件类型",
				ownerName: "法人姓名",				
				ownerIdCard: "123456789",
				applicantPhone: "18249002993",
				transformer: "否",
				capacity: "30",
				typeProof: "企业主体证明类型",				
				enterpriseName: "企业名称",
				installLocationList: '',
				companyPhoto: that.data.imgs,
				equityProveList: that.data.imgs,
				authorizationPhoto: that.data.imgs,
				identityProveList: that.data.imgs,
		    },
		    success(res){
		        if (res.data.status == "0000") {
		           console.log(res.data.message)
		        }else{
		            wx.showToast({
		                title: res.data.message,
		                icon: "none",
		                duration: 2000,
		              });
		        }
		       
		    }
		})
    },
	onLoad: function (options) {
	   
	},
	onRegionTap: function (e) {
	    wx.showLoading({
	        title: "加载中...",
	    })
	    var _this = this
	    var parentId = e.currentTarget.dataset.id || ''
	    var name = e.currentTarget.dataset.name || ''
	    var url = parentId ? `/ty/heatingApplet/address/addressList?parentId=${parentId}` : `/ty/heatingApplet/address/addressList`;
		
	    this.setAreaTap(name);
	    wx.request({
	        url: "https://testxny.tongyunzn.com" + url,
	        method: "get",
	        header: {
	            "content-type": "application/x-www-form-urlencoded", // 默认值
	            "token":"MTkwLTE2MDEwOTYzMjkyNzktMGNiMDZmMWQ4OGRjNGM3YTg1ZDlhYjBmOTY4NGM0NzA="},
	        success: function (res) {
			 
	            if (res.data.status == "0000") {
	                _this.setData({
	                    addressView: res.data.result,
	                    showAddressModel: true,
	                })
	
	                if (res.data.result.length == 0) {
	                    var area = ''
	                    for(var i=0; i < _this.data.areaArray.length-1; i++){
	                        area += _this.data.areaArray[i]
	                    }
	                    _this.setData({
	                        showAddressModel: false,
	                        regionId: parentId,
	                        area: area
	                    })
	                    wx.removeStorageSync('areaArray')
	                }
	            }
	        },
	        complete: function () {
	            wx.hideLoading()
	        }
	    })
	},
	setAreaTap: function (name) {
	    var select = "请选择"
	    var areaArray = wx.getStorageSync('areaArray') || []
	    areaArray.pop()
	    name !== '' && areaArray.push(name)
	    areaArray.push(select)
	    wx.setStorageSync('areaArray', areaArray)
	    this.setData({
	        areaArray: areaArray
	    })
	},
	closedModel: function (e) {
	    this.setData({
	        showAddressModel: false,
	    });
	    wx.showTabBar({
	        animation: false,
	        success: (res) => {
	            console.log("showTabBar", res);
	        },
	    });
	    wx.removeStorageSync('areaArray')
	},
	
	
	
})