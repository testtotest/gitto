
Page({

  /**
   * 页面的初始数据
   */
  data: {
       showAddressModel: false,
	   addresslist: [],
	   showd: false, //是否是住宅用电
	   isshowd:'请选择',
	   itemsshowd:  [{
	         message: '安装',
	       },{
	         message: '不安装'
	       }],
	   isbg:false,		
	   		  
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {

  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {

  }, 
  onBtna:function (){
  	this.setData({showd:true,isbg:true})
  },
  selBtnb:function (res){
  	this.setData({isshowd:this.data.itemsshowd[res.currentTarget.id].message})
  	this.setData({showd:false,isbg:false})		
  },
  cloBtnb:function (){
  	this.setData({showd:false,isbg:false})
  },
  onRegionTap: function (e) {
      wx.showLoading({
          title: "加载中...",
      })
      var _this = this
      var parentId = e.currentTarget.dataset.id || ''
      var name = e.currentTarget.dataset.name || ''
      var url = parentId ? `/ty/heatingApplet/address/addressList?parentId=${parentId}` : `/ty/heatingApplet/address/addressList`;
  	
      this.setAreaTap(name);
      wx.request({
          url: "https://testxny.tongyunzn.com" + url,
          method: "get",
          header: {
              "content-type": "application/x-www-form-urlencoded", // 默认值
              "token":"MTkwLTE2MDEwOTYzMjkyNzktMGNiMDZmMWQ4OGRjNGM3YTg1ZDlhYjBmOTY4NGM0NzA="},
          success: function (res) {
  		 
              if (res.data.status == "0000") {
                  _this.setData({
                      addressView: res.data.result,
                      showAddressModel: true,
                  })
  
                  if (res.data.result.length == 0) {
                      var area = ''
                      for(var i=0; i < _this.data.areaArray.length-1; i++){
                          area += _this.data.areaArray[i]
                      }
                      _this.setData({
                          showAddressModel: false,
                          regionId: parentId,
                          area: area
                      })
                      wx.removeStorageSync('areaArray')
                  }
              }
          },
          complete: function () {
              wx.hideLoading()
          }
      })
  },
  setAreaTap: function (name) {
      var select = "请选择"
      var areaArray = wx.getStorageSync('areaArray') || []
      areaArray.pop()
      name !== '' && areaArray.push(name)
      areaArray.push(select)
      wx.setStorageSync('areaArray', areaArray)
      this.setData({
          areaArray: areaArray
      })
  },
  closedModel: function (e) {
      this.setData({
          showAddressModel: false,
      });
      wx.showTabBar({
          animation: false,
          success: (res) => {
              console.log("showTabBar", res);
          },
      });
      wx.removeStorageSync('areaArray')
  },
  changeDate:function(e){      
      var date = e.detail.value;
      this.setData({
        currentDate:date
      })
    },
})