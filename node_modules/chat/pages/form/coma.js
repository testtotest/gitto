var app = getApp()
Page({

  /**
   * 页面的初始数据
   */
  data: {
       showAddressModel: false,
	   addresslist: [],
	   showd: false, //是否是住宅用电
	   isshowd:'请选择',
	   itemsshowd:  [{
	         message: '安装',
	       },{
	         message: '不安装'
	       }],
	   isbg:false,
	   token:'MTkwLTE2MDEzNDY5ODA0MTgtMWY3ODA4ZjUwYmQ5NGVhZWEzYTIzNGE2MjQ0MDMwY2I=',
	  
	   		  
  },
  onLoad: function (options) {
 //    var test=[];
	// var imgstr={"photo":"a"}	
	// test[0]='';
	// test[1]=imgstr; 
	// console.log(test)
    wx.setStorageSync("region",null)
    wx.setStorageSync("address",null)
    wx.setStorageSync("transformer",null)
    wx.setStorageSync("capacity",null)
    wx.setStorageSync("powerConsumptionTime",null)					
    wx.setStorageSync("typeProof",null) 
    wx.setStorageSync("enterpriseName",null)	
    wx.setStorageSync("companyPhoto",null)
    wx.setStorageSync("equityProveType",null)
    wx.setStorageSync("equityProveList",null)
  },
  btnForm:function (){
	  var transformerInt
  	  var _this = this
	
	
	 
  	  if (!_this.data.regionId) {
  	      wx.showToast({
  	          title: "地区不得为空",
  	          icon: "none",
  	          duration: 2000,
  	      });
  	      return false;
  	  }
  	  if (!_this.data.address) {
  	      wx.showToast({
  	          title: "详细地址不得为空",
  	          icon: "none",
  	          duration: 2000,
  	      });
  	      return false;
  	  }
	  if(_this.data.itemsshowdSel=="安装")
	        transformerInt=1
	  else if(_this.data.itemsshowdSel=="不安装")
	        transformerInt=2
	  else
	  {
	  	wx.showToast({
	  	    title: "是否安装变压器不得为空",
	  	    icon: "none",
	  	    duration: 2000,
	  	});
	  	return false;
	  }
  	  wx.setStorageSync("region",_this.data.regionId)
  	  wx.setStorageSync("address",_this.data.address)
  	  wx.setStorageSync("transformer",transformerInt)			
	  wx.setStorageSync("capacity",_this.data.capacity)
	  wx.setStorageSync("powerConsumptionTime",_this.data.currentDate)
	  wx.navigateTo({url:"./comb"})
	  
  	 
  }, 

  /**
   * 生命周期函数--监听页面加载
   */
 

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {

  }, 

  onBtna:function (){
  	this.setData({showd:true,isbg:true})
  },
  selBtnb:function (res){
  	this.setData({isshowd:this.data.itemsshowd[res.currentTarget.id].message})
  	this.setData({showd:false,isbg:false})
	this.setData({itemsshowdSel:this.data.itemsshowd[res.currentTarget.id].message})		
  },
  cloBtnb:function (){
  	this.setData({showd:false,isbg:false})
  },
  onRegionTap: function (e) {
      wx.showLoading({
          title: "加载中...",
      })
      var _this = this
      var parentId = e.currentTarget.dataset.id || ''
      var name = e.currentTarget.dataset.name || ''
      var url = parentId ? `/ty/heatingApplet/address/addressList?parentId=${parentId}` : `/ty/heatingApplet/address/addressList`;
  	
      this.setAreaTap(name);
      wx.request({
          url: app.globalData.baseUrl + url,
          method: "get",
          header: {
              "content-type": "application/x-www-form-urlencoded", // 默认值
              "token":app.globalData.token},
          success: function (res) {
  		 
              if (res.data.status == "0000") {
                  _this.setData({
                      addressView: res.data.result,
                      showAddressModel: true,
                  })
  
                  if (res.data.result.length == 0) {
                      var region = ''
                      for(var i=0; i < _this.data.areaArray.length-1; i++){
                          region += _this.data.areaArray[i]
                      }
                      _this.setData({
                          showAddressModel: false,
                          regionId: parentId,
                          region: region
                      })
                      wx.removeStorageSync('areaArray')
                  }
              }
          },
          complete: function () {
              wx.hideLoading()
          }
      })
  },
  setAreaTap: function (name) {
      var select = "请选择"
      var areaArray = wx.getStorageSync('areaArray') || []
      areaArray.pop()
      name !== '' && areaArray.push(name)
      areaArray.push(select)
      wx.setStorageSync('areaArray', areaArray)
      this.setData({
          areaArray: areaArray
      })
  },
  closedModel: function (e) {
      this.setData({
          showAddressModel: false,
      });
      wx.showTabBar({
          animation: false,
          success: (res) => {
              //console.log("showTabBar", res);
          },
      });
      wx.removeStorageSync('areaArray')
  },
  changeDate:function(e){      
      var date = e.detail.value;
      this.setData({
        currentDate:date
      })
    },
})