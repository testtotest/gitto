const app = getApp();
const util = require("../../utils/util");
Page({
  /**
   * 页面的初始数据
   */
  data: {
    img:app.globalData.staticImg,
   // isCash: true,
    isinvite: 1,//奖励邀请明细状态  1  暂无邀请记录  2  已有邀请明细记录
    isCash:1, //  提现记录状态   1.暂无提现记录   2已有提现记录
    ishow:1, //奖励明细和提现记录 切换显示  1  显示 奖励明细内容     2  显示提现记录内容
    active: true,  ///true  奖励明细下划线     false   提现记录下划线
    rewardList:[],
    cashList:[],
    amount:'0.00',
    balance:'0.00',
  },
  handleReward: function () {
    this.setData({
      ishow: 1, // 奖励    1
      active: true,
    });
    this.rewardDetail(1,100)
  },
  handleCash: function () {
    this.setData({
      ishow: 2, //提现
      active: false,
    });
   this.cashDetial(1,100)
  },
  toCash:function(){
    wx.navigateTo({
      url: '../../pages/cashing/cashing',
    })

  },
  //奖励明细
  rewardDetail: function(pageNo,pageSize){
    var that =this;
    wx.request({
      url: app.globalData.baseUrl + "/ty/heatingApplet/data/runningWater",
      method: "post",
      header: {
        "content-type": "application/json", // 默认值
        token: app.globalData.token,
      },
      data: {
        userId:app.globalData.userId,
        pageNo:pageNo,
        pageSize:pageSize
      },
      success: (res) => {
        if(res.data.status !='0000'){
          wx.showToast({
            title: res.data.message,
            icon: "none",
            duration: 2000,
          });
          return false
        }
      //  console.log("奖励明细-----",res.data.result);

      // if(res.data.result.list.length < 1){
      //   that.setData({
      //     isinvite:1
      //   })
      // }
        that.setData({
          //rewardList: that.data.rewardList+res.data.result.list,
          rewardList:res.data.result.list
        });

      },
    });
  },
  //提现记录
  cashDetial:function(pageNo,pageSize){
    var that =this;
    wx.request({
      url: app.globalData.baseUrl + "/ty/heatingApplet/data/runningWithdrawWater",
      method: "post",
      header: {
        "content-type": "application/json", // 默认值
        token: app.globalData.token,
      },
      data: {
        userId:app.globalData.userId,
        pageNo:pageNo,
        pageSize:pageSize
      },
      success: (res) => {
        if(res.data.status !='0000'){
          wx.showToast({
            title: res.data.message,
            icon: "none",
            duration: 2000,
          });
          return false
        }
       // console.log("提现记录-----",res.data.result);
        if(res.data.result.count>0){
          that.setData({
            cashList:res.data.result.list,
            isCash:2
          });
        }else{
          that.setData({
            //cashList:res.data.result.list,
            isCash:1
          });
        }

      },
    });
  },
  getReward:function(){
    var that =this;
    wx.request({
      url: app.globalData.baseUrl + "/ty/heatingApplet/data/wallet",
      method: "post",
      header: {
        "content-type": "application/json", // 默认值
        token: app.globalData.token,
      },
      data: {
        userId:app.globalData.userId
      },
      success: (res) => {
        if(res.data.status !='0000'){
          wx.showToast({
            title: res.data.message,
            icon: "none",
            duration: 2000,
          });
          return false
        }
       // console.log("getReward000----",res.data.result);
        if(res.data.result.amount>0){
          that.setData({
            amount:res.data.result.amount,
            balance:res.data.result.balance,
            isinvite:2  //没有邀请奖励  1   有奖励  2
          })
        }else{
          that.setData({
            isinvite:1   //----------------------------------/////////////////////此处应该是1     测试改成2     上线要修改
          })
          if(that.data.ishow ==1){
            that.rewardDetail(1,100)  //调用奖励明细的接口
          }else if(that.data.ishow ==2){
            that.cashDetial(1,100) //调用提现记录的接口
          }
        }
        wx.hideLoading({
          icon:"none"
        })
        wx.stopPullDownRefresh()
        // that.setData({
        //   productData: res.data.result,
        // });
      },
    });
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    wx.showLoading({
      title: '页面加载中...',
    })
  //  console.log('options',options)
    if(options.active){
      this.setData({
        ishow:2,
        active:false
      })
    }
    this.getReward()
    this.rewardDetail(1,100)
    this.cashDetial(1,100)
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {},

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {
    wx.showLoading({
      title: '页面加载中...',
    })
    this.getReward()
    this.rewardDetail(1,100)
    this.cashDetial(1,100)
  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {},

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {},

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {
    wx.showLoading({
      title: '页面重新加载中...',
    })
    this.getReward()
  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {},

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function (res) {
    if (res.from === 'button') {
      // 来自页面内转发按钮
    //  console.log(res.target)
    }
    return {
      title: app.globalData.shareTitle,
      imageUrl:app.globalData.shareImgUrl,
      path: '/pages/index/index?invCode='+app.globalData.invCode
    }
  },
});
