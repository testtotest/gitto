<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>任务</title>
		<script src="bdist/js/jquery.min.js"></script>
		<script src="bdist/js/bootstrap.min.js"></script>
		<script src="bdist/js/jquerysession.js"></script>
		<link rel="stylesheet" href="bdist/css/bootstrap.min.css">
		<link rel="stylesheet" href="bdist/css/sign.css">	
		<link rel="stylesheet" href="bdist/css/pub.css">	
		<style>
			p {padding: 0 0 5px 0;}
		</style>
	</head>
	<body>	
		<div class="tab">
			<a href="javascript:;" class="item cur">全部</a>
			<a href="javascript:;" class="item">待提交</a>
			<a href="javascript:;" class="item">待审核</a>
			<a href="javascript:;" class="item">已完成</a>
			<a href="javascript:;" class="item">已放弃</a>
		</div>
		<div class="w-95  m-auto renwu f-size-09 pt-2 list pb-6"></div>
		<script>
		$(function(){			
			$('.tab .item').on('click',function(){
				var $this = $(this);
				itemIndex = $this.index();				
				$this.addClass('cur').siblings('.item').removeClass('cur');
				$('.lists').eq(itemIndex).show().siblings('.lists').hide();
				list(itemIndex)
			})			
		});
		list()
		function upbtn(tid)
		{
			var parpam ={}
			parpam.recieveId = tid;			 
			$.ajax({
					type: 'POST',
					url: "http://101.200.129.62:8082/ty/incrementHf/task/submitTask",
					data: JSON.stringify(parpam),
					contentType: "application/json",
					headers: {
					  token: $.session.get('token')
					},	
					success: function(data){
						if(data.status=="0000")
						{
							alert(data.message);
						}
						else
						{
							alert(data.message);
						}						
					}
			});			
		}
		function nobtn(tid)
		{
			var parpam ={}
			parpam.recieveId = tid;			 
			$.ajax({
					type: 'POST',
					url: "http://101.200.129.62:8082/ty/incrementHf/task/giveUpTask",
					data: JSON.stringify(parpam),
					contentType: "application/json",
					headers: {
					  token: $.session.get('token')
					},	
					success: function(data){
						if(data.status=="0000")
						{
							alert(data.message);
						}
						else
						{
							alert(data.message);
						}
						
					}
			});			
		}
			
		function getToDate(time)
		{	
			var data = new Date(time);
			    var year = data.getFullYear();  //获取年
			    var month = data.getMonth() + 1;    //获取月
			    var day = data.getDate(); //获取日
			    var hours = data.getHours();
			    var minutes = data.getMinutes();
			    var seconds = data.getSeconds();
			 
			    /**
			     * 与当前时间比较，显示 今天 10:10:10
			     */
			    //var date=new Date();
			    /*if (date.getFullYear()==year&&date.getMonth() + 1==month){
			        if (date.getDate()==day){
			            time = "今天" + " " + hours + ":" + minutes + ":" + seconds;
			            return time;
			        }
			        if ((parseInt(date.getDate())-1)==day){
			            time = "昨天" + " " + hours + ":" + minutes + ":" + seconds;
			            return time;
			        }
			    }*/
			 
			    time = year + "/" + month + "/" + day + "/" + " " + hours + ":" + minutes + ":" + seconds;
			    return time;
			
		}
		
		function list(status)
		{
			var url="http://101.200.129.62:8082"
			var parpam ={}
			parpam.userId = $.session.get('uid');
			parpam.status = status;
			$.ajax({
					type: 'Get',
					url: url+"/ty/incrementHf/task/myTaskList",	
					data: parpam,			
					headers: {
					  token: $.session.get('token')
					},				
					success: function(data){
						if(data.status=="0000")
						{
							$(".list").append('')
							$.each(data.result.list,function(i,val){
								var status=""
								var txt=""
								if(val.status==1)
								{							
									status="已领取"
									txt='<div class="pb-3"><button type="button" onclick="nobtn('+val.recieveId+')" class="btn btn-outline-warning mr-2 " style="width: 47%;">放弃任务</button><button onclick="upbtn('+val.recieveId+')" type="button" class="upbtn btn btn-warning" style="width: 47%;">提交任务</button></div>'
								}
								else if(val.status==2)
								{    status="已提交"}
								else if(val.status==3)
								{    status="审核驳回"}
								else if(val.status==4)
								{    status="审核通过"}
								else if(val.status==5)
								{     status="已取消"}	
								else if(val.status==6)
								{    status="超时"}	
								
								 
								 $(".list").append('<a href="paiinfo?type=1&id='+val.recieveId+'"><div class="mb-2 rounded bg-f"><div class="d-flex justify-content-between bd-highlight"><div class="p-2 bd-highlight"><b>'+val.title+'('+val.recieveId+')</b></div><div class="p-2 bd-highlight" style="color: #FFD46F;">'+status+'</div></div><div class="d-flex justify-content-between bd-highlight"><div class="p-2 bd-highlight">赏金</div><div class="p-2 bd-highlight">'+val.moneyReward+'</div></div><div class="d-flex justify-content-between bd-highlight"><div class="p-2 bd-highlight">接单时间</div><div class="p-2 bd-highlight">1分钟</div></div><div class="d-flex justify-content-between bd-highlight mb-3"><div class="p-2 bd-highlight">最晚提交时间</div><div class="p-2 bd-highlight">0</div></div>'+txt+'</div></a>');
							});							
						}
						else
						{
							alert(data.message);
						}
						
					}
			});				
		}
		</script>
		<div class="fixed-bottom bg-f pt-2 pl-4 pr-4 m-set">
			<div class="d-flex justify-content-between">
				<a href="pd_zx.html">
				<div class=" bd-highlight t-center">
					<p><img src="bdist/img/paidans.png" /></p>
					<p>派单中心</p>
				</div>
				</a>
				<a href="renwu.html">
				<div class=" bd-highlight t-center">
					<p><img src="bdist/img/renwu.png" /></p>
					<p>我的任务</p>
				</div>
				</a>
				<a href="set.html">
					<div class=" bd-highlight t-center">
						<p><img src="bdist/img/wodes.png" /></p>
						<p>个人中心</p>
					</div>
				</a>
			</div>
		</div>
		
	</body>
</html>
